      - name: Send to Feishu
        if: steps.changed-files.outputs.any_changed == 'true'
        env:
          FEISHU_TOKEN: ${{ steps.token.outputs.token }}
          FEISHU_RECEIVE_ID: ${{ secrets.FEISHU_RECEIVE_ID }}
          REPO_URL: https://github.com/${{ github.repository }}/blob/main
        run: |
          # âš ï¸ é‡è¦ï¼šè¯·æ ¹æ®ä½ çš„ ID ç±»å‹ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œ
          # å¦‚æœæ˜¯å‘ç»™ä¸ªäºº (ou_...) å¡« open_id
          # å¦‚æœæ˜¯å‘ç»™ç¾¤ (oc_...) å¡« chat_id
          RECEIVE_ID_TYPE="open_id" 
          
          for file in ${{ steps.changed-files.outputs.all_changed_files }}; do
            filename=$(basename "$file")
            
            # è¯»å–æ–‡ä»¶å‰ 10 è¡Œï¼Œå¹¶è¿›è¡Œä¸¥æ ¼çš„ JSON è½¬ä¹‰
            raw_content=$(cat "$file" | head -10)
            safe_content=$(echo "$raw_content" | jq -Rs '.') 
            
            # æ„å»ºå®Œæ•´çš„å¡ç‰‡ JSON
            card_payload=$(jq -n \
              --arg title "$filename" \
              --arg content "$safe_content" \
              --arg url "$REPO_URL/$file" \
              '{
                "card": {
                  "header": {
                    "title": { "tag": "plain_text", "content": ("ğŸ“š " + $title) },
                    "template": "blue"
                  },
                  "elements": [
                    {
                      "tag": "div",
                      "text": { "tag": "lark_md", "content": $content }
                    },
                    {
                      "tag": "action",
                      "actions": [
                        {
                          "tag": "button",
                          "text": { "tag": "plain_text", "content": "æŸ¥çœ‹åŸæ–‡" },
                          "url": $url,
                          "type": "primary"
                        }
                      ]
                    }
                  ]
                }
              }')

            echo "ğŸš€ Sending update for: $filename"
            
            # âœ… ä¿®å¤åçš„ curl å‘½ä»¤ï¼šæ˜ç¡®æ‹¼æ¥ URL å‚æ•°
            response=$(curl -s -w "\n%{http_code}" -X POST \
              -H "Authorization: Bearer $FEISHU_TOKEN" \
              -H "Content-Type: application/json" \
              -d "{
                \"receive_id\": \"$FEISHU_RECEIVE_ID\",
                \"msg_type\": \"interactive\",
                \"content\": $card_payload
              }" \
              "https://open.feishu.cn/open-apis/im/v1/messages?receive_id_type=$RECEIVE_ID_TYPE")
            
            # åˆ†ç¦»å“åº”ä½“å’ŒçŠ¶æ€ç 
            http_code=$(echo "$response" | tail -n1)
            body=$(echo "$response" | sed '$d')
            
            if [ "$http_code" == "200" ]; then
               # åŒé‡æ£€æŸ¥ä¸šåŠ¡çŠ¶æ€ç 
               code=$(echo "$body" | jq -r '.code')
               if [ "$code" == "0" ]; then
                 echo "âœ… Sent successfully: $filename"
               else
                 echo "âŒ Feishu API Error: $body"
               fi
            else
              echo "âš ï¸ HTTP Request Failed: $http_code - $body"
            fi
          done
